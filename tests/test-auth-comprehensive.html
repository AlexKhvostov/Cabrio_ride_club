<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ CabrioRide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            color: #888;
            font-size: 1.1rem;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }
        
        .test-card h3 {
            color: #00ff88;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .test-card p {
            color: #ccc;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .test-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #0077cc, #0055aa);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            text-decoration: none;
            text-align: center;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 119, 204, 0.3);
        }
        
        .test-btn.success {
            background: linear-gradient(135deg, #00ff88, #00cc66);
        }
        
        .test-btn.warning {
            background: linear-gradient(135deg, #ffaa00, #cc8800);
        }
        
        .test-btn.danger {
            background: linear-gradient(135deg, #ff3366, #cc2244);
        }
        
        .status-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .status-section h4 {
            color: #00ff88;
            margin-bottom: 15px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            color: #ccc;
        }
        
        .status-value {
            font-weight: bold;
        }
        
        .status-value.success {
            color: #00ff88;
        }
        
        .status-value.error {
            color: #ff3366;
        }
        
        .status-value.warning {
            color: #ffaa00;
        }
        
        .log-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .log-section h4 {
            color: #00ff88;
            margin-bottom: 15px;
        }
        
        .log-content {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #ccc;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .clear-log {
            background: #ff3366;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.8rem;
        }
        
        .clear-log:hover {
            background: #cc2244;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ CabrioRide</h1>
            <p>–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</p>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã -->
        <div class="status-section">
            <h4>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h4>
            <div class="status-item">
                <span class="status-label">–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:</span>
                <span class="status-value" id="dev-mode-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Telegram Bot:</span>
                <span class="status-value" id="bot-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="status-item">
                <span class="status-label">API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:</span>
                <span class="status-value" id="api-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="status-item">
                <span class="status-label">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</span>
                <span class="status-value" id="db-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="status-item">
                <span class="status-label">HTTPS:</span>
                <span class="status-value" id="https-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
        </div>

        <div class="test-grid">
            <!-- –¢–µ—Å—Ç Telegram Widget -->
            <div class="test-card">
                <h3>ü§ñ Telegram Login Widget</h3>
                <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram Login Widget –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testTelegramWidget()">–¢–µ—Å—Ç Widget</button>
                    <button class="test-btn warning" onclick="testWidgetCallback()">–¢–µ—Å—Ç Callback</button>
                    <button class="test-btn danger" onclick="testWidgetErrors()">–¢–µ—Å—Ç –æ—à–∏–±–æ–∫</button>
                </div>
            </div>

            <!-- –¢–µ—Å—Ç API –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
            <div class="test-card">
                <h3>üîó API –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h3>
                <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoints –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testVerifyUser()">–¢–µ—Å—Ç verify_user</button>
                    <button class="test-btn warning" onclick="testAuthCallback()">–¢–µ—Å—Ç auth-callback</button>
                    <button class="test-btn danger" onclick="testApiErrors()">–¢–µ—Å—Ç –æ—à–∏–±–æ–∫ API</button>
                </div>
            </div>

            <!-- –¢–µ—Å—Ç dev –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
            <div class="test-card">
                <h3>üõ†Ô∏è Dev –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
                <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testDevAuth()">–¢–µ—Å—Ç dev_auth</button>
                    <button class="test-btn warning" onclick="testLocalhost()">–¢–µ—Å—Ç localhost</button>
                    <button class="test-btn" onclick="testAutoAuth()">–¢–µ—Å—Ç auto-auth.html</button>
                </div>
            </div>

            <!-- –¢–µ—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
            <div class="test-card">
                <h3>üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testSignature()">–¢–µ—Å—Ç –ø–æ–¥–ø–∏—Å–∏</button>
                    <button class="test-btn warning" onclick="testTokenExpiry()">–¢–µ—Å—Ç —Ç–æ–∫–µ–Ω–æ–≤</button>
                    <button class="test-btn danger" onclick="testInjection()">–¢–µ—Å—Ç –∏–Ω—ä–µ–∫—Ü–∏–π</button>
                </div>
            </div>

            <!-- –¢–µ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="test-card">
                <h3>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –¥–æ—Å—Ç—É–ø–∞</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testActiveUser()">–ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</button>
                    <button class="test-btn warning" onclick="testInactiveUser()">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</button>
                    <button class="test-btn danger" onclick="testBlockedUser()">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</button>
                </div>
            </div>

            <!-- –¢–µ—Å—Ç –º–æ–±–∏–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
            <div class="test-card">
                <h3>üì± –ú–æ–±–∏–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
                <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testMobileAuth()">–¢–µ—Å—Ç –º–æ–±–∏–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</button>
                    <button class="test-btn warning" onclick="testMobileLink()">–¢–µ—Å—Ç –º–æ–±–∏–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏</button>
                    <button class="test-btn" onclick="testMobileCallback()">–¢–µ—Å—Ç callback</button>
                </div>
            </div>
        </div>

        <!-- –õ–æ–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div class="log-section">
            <h4>üìù –õ–æ–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
            <div class="log-content" id="test-log">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...</div>
            <button class="clear-log" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let testLog = [];
        const API_BASE = 'https://club.cabrioride.by/backend';
        
        // –§—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            testLog.push(logEntry);
            updateLogDisplay();
            console.log(logEntry);
        }
        
        function updateLogDisplay() {
            const logElement = document.getElementById('test-log');
            logElement.textContent = testLog.join('\n');
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLog() {
            testLog = [];
            updateLogDisplay();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã
        async function checkSystemStatus() {
            log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã...');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
            const isDev = window.location.hostname === 'localhost' || 
                         window.location.hostname === '127.0.0.1' ||
                         window.location.protocol === 'file:';
            
            document.getElementById('dev-mode-status').textContent = isDev ? '–í–∫–ª—é—á–µ–Ω' : '–í—ã–∫–ª—é—á–µ–Ω';
            document.getElementById('dev-mode-status').className = `status-value ${isDev ? 'success' : 'warning'}`;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
            const isHttps = window.location.protocol === 'https:';
            document.getElementById('https-status').textContent = isHttps ? '–í–∫–ª—é—á–µ–Ω' : '–í—ã–∫–ª—é—á–µ–Ω';
            document.getElementById('https-status').className = `status-value ${isHttps ? 'success' : 'error'}`;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ API
            try {
                const response = await fetch(`${API_BASE}/api.php?action=stats`);
                if (response.ok) {
                    document.getElementById('api-status').textContent = '–î–æ—Å—Ç—É–ø–µ–Ω';
                    document.getElementById('api-status').className = 'status-value success';
                    log('‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                document.getElementById('api-status').textContent = '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                document.getElementById('api-status').className = 'status-value error';
                log(`‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`, 'error');
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
            try {
                const response = await fetch(`${API_BASE}/api.php?action=members`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        document.getElementById('db-status').textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∞';
                        document.getElementById('db-status').className = 'status-value success';
                        log('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞');
                    } else {
                        throw new Error(data.error || '–û—à–∏–±–∫–∞ –ë–î');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                document.getElementById('db-status').textContent = '–û—à–∏–±–∫–∞';
                document.getElementById('db-status').className = 'status-value error';
                log(`‚ùå –û—à–∏–±–∫–∞ –ë–î: ${error.message}`, 'error');
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram Bot
            try {
                const response = await fetch(`${API_BASE}/api.php?action=verify_user`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: 123456789 })
                });
                
                if (response.ok) {
                    document.getElementById('bot-status').textContent = '–ù–∞—Å—Ç—Ä–æ–µ–Ω';
                    document.getElementById('bot-status').className = 'status-value success';
                    log('‚úÖ Telegram Bot –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                document.getElementById('bot-status').textContent = '–û—à–∏–±–∫–∞';
                document.getElementById('bot-status').className = 'status-value error';
                log(`‚ùå –û—à–∏–±–∫–∞ Telegram Bot: ${error.message}`, 'error');
            }
        }
        
        // –¢–µ—Å—Ç—ã Telegram Widget
        function testTelegramWidget() {
            log('üß™ –¢–µ—Å—Ç Telegram Login Widget...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Widget –≤ DOM
            const widget = document.querySelector('script[data-telegram-login]');
            if (widget) {
                log('‚úÖ Telegram Widget –Ω–∞–π–¥–µ–Ω –≤ DOM');
                log(`üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Widget: ${widget.getAttribute('data-telegram-login')}`);
            } else {
                log('‚ùå Telegram Widget –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM', 'error');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
            if (typeof window.onTelegramAuth === 'function') {
                log('‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è onTelegramAuth –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞');
            } else {
                log('‚ùå –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è onTelegramAuth –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
            }
        }
        
        function testWidgetCallback() {
            log('üß™ –¢–µ—Å—Ç callback —Ñ—É–Ω–∫—Ü–∏–∏...');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç Telegram
            const mockUser = {
                id: 123456789,
                first_name: '–¢–µ—Å—Ç',
                last_name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                username: 'testuser',
                photo_url: null,
                auth_date: Math.floor(Date.now() / 1000),
                hash: 'mock_hash'
            };
            
            try {
                if (typeof window.onTelegramAuth === 'function') {
                    window.onTelegramAuth(mockUser);
                    log('‚úÖ Callback —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑–≤–∞–Ω–∞ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏');
                } else {
                    log('‚ùå Callback —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤ callback: ${error.message}`, 'error');
            }
        }
        
        function testWidgetErrors() {
            log('üß™ –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ Widget...');
            
            // –¢–µ—Å—Ç —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            const invalidUser = { id: null };
            
            try {
                if (typeof window.onTelegramAuth === 'function') {
                    window.onTelegramAuth(invalidUser);
                    log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: ${error.message}`, 'error');
            }
        }
        
        // –¢–µ—Å—Ç—ã API
        async function testVerifyUser() {
            log('üß™ –¢–µ—Å—Ç API verify_user...');
            
            try {
                const response = await fetch(`${API_BASE}/api.php?action=verify_user`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: 287536885 }) // –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ API –æ—Ç–≤–µ—Ç: ${JSON.stringify(data)}`);
                } else {
                    log(`‚ùå HTTP –æ—à–∏–±–∫–∞: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ API: ${error.message}`, 'error');
            }
        }
        
        async function testAuthCallback() {
            log('üß™ –¢–µ—Å—Ç auth-callback.php...');
            
            try {
                const response = await fetch(`${API_BASE}/auth-callback.php`, {
                    method: 'GET'
                });
                
                log(`üìã –°—Ç–∞—Ç—É—Å auth-callback: ${response.status}`);
                
                if (response.ok) {
                    const text = await response.text();
                    log('‚úÖ auth-callback –¥–æ—Å—Ç—É–ø–µ–Ω');
                } else {
                    log(`‚ùå auth-callback –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ auth-callback: ${error.message}`, 'error');
            }
        }
        
        function testApiErrors() {
            log('üß™ –¢–µ—Å—Ç –æ—à–∏–±–æ–∫ API...');
            
            // –¢–µ—Å—Ç —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            fetch(`${API_BASE}/api.php?action=verify_user`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ invalid: 'data' })
            })
            .then(response => response.json())
            .then(data => {
                log(`üìã –û—Ç–≤–µ—Ç –Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(data)}`);
            })
            .catch(error => {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            });
        }
        
        // –¢–µ—Å—Ç—ã dev –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function testDevAuth() {
            log('üß™ –¢–µ—Å—Ç dev –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            
            const isDev = window.location.hostname === 'localhost' || 
                         window.location.hostname === '127.0.0.1' ||
                         window.location.protocol === 'file:';
            
            if (isDev) {
                log('‚úÖ –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∞–∫—Ç–∏–≤–µ–Ω');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
                const storedUser = localStorage.getItem('cabrioride_user');
                if (storedUser) {
                    log(`üìã –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${storedUser}`);
                } else {
                    log('üìã –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
                }
            } else {
                log('‚ö†Ô∏è –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω', 'warning');
            }
        }
        
        function testLocalhost() {
            log('üß™ –¢–µ—Å—Ç localhost –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º localhost
            const originalHostname = window.location.hostname;
            Object.defineProperty(window.location, 'hostname', {
                value: 'localhost',
                writable: true
            });
            
            log('‚úÖ Localhost —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω');
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
            Object.defineProperty(window.location, 'hostname', {
                value: originalHostname,
                writable: true
            });
        }
        
        function testAutoAuth() {
            log('üß™ –¢–µ—Å—Ç auto-auth.html...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞
            fetch('auto-auth.html')
                .then(response => {
                    if (response.ok) {
                        log('‚úÖ auto-auth.html –¥–æ—Å—Ç—É–ø–µ–Ω');
                    } else {
                        log(`‚ùå auto-auth.html –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${response.status}`, 'error');
                    }
                })
                .catch(error => {
                    log(`‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ auto-auth.html: ${error.message}`, 'error');
                });
        }
        
        // –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        function testSignature() {
            log('üß™ –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏...');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏
            const authData = {
                id: 123456789,
                first_name: 'Test',
                auth_date: Math.floor(Date.now() / 1000),
                hash: 'invalid_hash'
            };
            
            log('üìã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é');
            log(`üìã –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(authData)}`);
        }
        
        function testTokenExpiry() {
            log('üß™ –¢–µ—Å—Ç –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤...');
            
            const now = Math.floor(Date.now() / 1000);
            const oldAuthDate = now - 86400; // 24 —á–∞—Å–∞ –Ω–∞–∑–∞–¥
            
            log(`üìã –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: ${now}`);
            log(`üìã –°—Ç–∞—Ä–æ–µ –≤—Ä–µ–º—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${oldAuthDate}`);
            log('üìã –†–∞–∑–Ω–∏—Ü–∞: 24 —á–∞—Å–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞)');
        }
        
        function testInjection() {
            log('üß™ –¢–µ—Å—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π...');
            
            const maliciousData = {
                id: "'; DROP TABLE members; --",
                first_name: '<script>alert("xss")</script>'
            };
            
            log('üìã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏');
            log(`üìã –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(maliciousData)}`);
        }
        
        // –¢–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function testActiveUser() {
            log('üß™ –¢–µ—Å—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
            
            try {
                const response = await fetch(`${API_BASE}/api.php?action=verify_user`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: 287536885 }) // –ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.data.access) {
                        log('‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø');
                    } else {
                        log('‚ùå –ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞', 'error');
                    }
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        async function testInactiveUser() {
            log('üß™ –¢–µ—Å—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
            
            try {
                const response = await fetch(`${API_BASE}/api.php?action=verify_user`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: 999999999 }) // –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (!data.data.access) {
                        log('‚úÖ –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω');
                    } else {
                        log('‚ùå –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª –¥–æ—Å—Ç—É–ø', 'error');
                    }
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        function testBlockedUser() {
            log('üß™ –¢–µ—Å—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
            log('üìã –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            log('üìã –°—Ç–∞—Ç—É—Å: –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
            log('üìã –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω');
        }
        
        // –¢–µ—Å—Ç—ã –º–æ–±–∏–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function testMobileAuth() {
            log('üß™ –¢–µ—Å—Ç –º–æ–±–∏–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const authMethod = localStorage.getItem('auth_method');
            const userVerified = localStorage.getItem('user_verified');
            const authToken = localStorage.getItem('auth_token');
            
            log(`üìã –ú–µ—Ç–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${authMethod || '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}`);
            log(`üìã –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≤–µ—Ä–µ–Ω: ${userVerified || '–Ω–µ—Ç'}`);
            log(`üìã –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${authToken ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'}`);
        }
        
        function testMobileLink() {
            log('üß™ –¢–µ—Å—Ç –º–æ–±–∏–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏...');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –º–æ–±–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
            const mobileLink = `${window.location.origin}/auto-auth.html?id=123456789&first_name=Test&auth_date=${Math.floor(Date.now() / 1000)}&hash=mock_hash`;
            
            log(`üìã –ú–æ–±–∏–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: ${mobileLink}`);
            log('üìã –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ auto-auth.html');
        }
        
        function testMobileCallback() {
            log('üß™ –¢–µ—Å—Ç –º–æ–±–∏–ª—å–Ω–æ–≥–æ callback...');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç –º–æ–±–∏–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const mobileData = {
                id: 123456789,
                first_name: '–ú–æ–±–∏–ª—å–Ω—ã–π',
                last_name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                auth_date: Math.floor(Date.now() / 1000),
                mobile: true
            };
            
            log(`üìã –ú–æ–±–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(mobileData)}`);
            log('üìã –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ auth-callback.php');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            checkSystemStatus();
        });
    </script>
</body>
</html> 